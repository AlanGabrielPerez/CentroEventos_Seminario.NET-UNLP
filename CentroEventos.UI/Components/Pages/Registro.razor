@page "/registro"
@using System.ComponentModel.DataAnnotations
@inject CrearSolicitudUsuarioUseCase crearSolicitudUsuario

<EditForm Model="@usuario" OnValidSubmit="Registrar" FormName="formRegistro">
    <DataAnnotationsValidator />
    <ValidationSummary />

    @if (!string.IsNullOrEmpty(mensaje))
    {
        <div class="@claseMensaje">@mensaje</div>
    }

    <div class="mb-3">
        <label>Email:</label>
        <InputText class="form-control" @bind-Value="usuario.Email" />
        <ValidationMessage For="@(() => usuario.Email)" />
    </div>

    <div class="mb-3">
        <label>Contraseña:</label>
        <InputText class="form-control" @bind-Value="usuario.PasswordHash" type="password" />
        <ValidationMessage For="@(() => usuario.PasswordHash)" />
    </div>

    <div class="mb-3">
        <label>Nombre:</label>
        <InputText class="form-control" @bind-Value="usuario.Nombre" />
        <ValidationMessage For="@(() => usuario.Nombre)" />
    </div>

    <div class="mb-3">
        <label>Apellido:</label>
        <InputText class="form-control" @bind-Value="usuario.Apellido" />
        <ValidationMessage For="@(() => usuario.Apellido)" />
    </div>

    <div class="mb-3">
        <label>DNI:</label>
        <InputText class="form-control" @bind-Value="usuario.DNI" />
        <ValidationMessage For="@(() => usuario.DNI)" />
    </div>

    <button type="submit" class="btn btn-primary">Registrarse</button>
</EditForm>

@code {
    private SolicitudUsuario usuario = new SolicitudUsuario();
  
    private string mensaje = "";
    private string claseMensaje = "";

    private void Registrar()
    {
        try
        {
            
            crearSolicitudUsuario.Ejecutar(usuario);

            mensaje = "Registro exitoso. Espera aprobación.";
            claseMensaje = "alert alert-success";

            usuario = new SolicitudUsuario();
        
        }
        catch (Exception ex)
        {
            mensaje = $"Error: {ex.Message}";
            claseMensaje = "alert alert-danger";
        }
    }
}